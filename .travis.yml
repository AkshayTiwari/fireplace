branches:
  only:
    - master
before_script:
  - "export PHANTOMJS_EXECUTABLE='phantomjs --local-to-remote-url-access=yes --ignore-ssl-errors=yes'"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - "npm install"
  - "nohup node damper.js &"  # start the damper
  - "git clone git://github.com/n1k0/casperjs.git casperjs"
  - "cd casperjs && git checkout 1.0.2 && cd .."  # Use Homebrew's version of casper
script:
  - "cd smokealarm && DISPLAY=:99.0 ../casperjs/bin/casperjs test tests"
